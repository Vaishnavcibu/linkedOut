<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Company Dashboard | LinkedOut</title>
    <link rel="stylesheet" href="../public/css/style.css">
    <style>
        .job-item {
            display: grid;
            /* Creates 3 columns: job info (takes up available space), edit btn, delete btn */
            grid-template-columns: 1fr auto auto;
            gap: 1rem;
            align-items: center;
            border-bottom: 1px solid var(--border-color);
            padding: 1.5rem 1rem;
        }
        .job-item:last-child {
            border-bottom: none;
        }
        .job-info-link {
            text-decoration: none;
            color: inherit;
        }
        .job-info {
            line-height: 1.4;
            padding-right: 1rem;
        }
        .job-actions {
            display: flex;
            gap: 0.5rem;
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="container navbar">
            <a href="/" class="logo"><div class="logo-icon"></div>LinkedOut</a>
            <ul class="nav-links"></ul> <!-- main.js will populate this -->
            <div class="nav-buttons"></div> <!-- main.js will populate this -->
        </div>
    </header>

    <main class="container" style="padding-top: 100px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
            <h1 class="page-title" style="margin: 0;">Your Job Postings</h1>
            <a href="/post-job" class="btn btn-primary">Post New Job</a>
        </div>
        <div id="job-list-container" class="glass-card" style="padding: 1rem;">
            <!-- Job listings will be dynamically inserted here -->
        </div>
    </main>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="../public/js/main.js"></script>
    <script>
        function loadJobs() {
            $.get('/api/jobs/my-jobs', function(jobs) {
                const jobList = $('#job-list-container');
                jobList.empty(); // Clear existing list
                if (jobs.length === 0) {
                    jobList.html('<p style="padding: 1rem; text-align: center;">You have not posted any jobs yet.</p>');
                    return;
                }
                jobs.forEach(job => {
                    jobList.append(`
                        <div class="job-item">
                            <a href="/job-details/${job._id}" class="job-info-link">
                                <div class="job-info">
                                    <h4 style="font-size: 1.2rem;">${job.title}</h4>
                                    <p style="color: var(--text-muted-color);">${job.company} - ${job.location}</p>
                                </div>
                            </a>
                            <div class="job-actions">
                                 <button class="btn" onclick="window.location.href='/edit-job/${job._id}'">Edit</button>
                                 <button class="btn btn-login" onclick="deleteJob('${job._id}')">Delete</button>
                            </div>
                        </div>
                    `);
                });
            }).fail(function() {
                window.location.href = '/login'; // Redirect if user is not authorized
            });
        }
        
        // This function sends the delete request to the backend
        function deleteJob(jobId) {
            if (confirm('Are you sure you want to permanently delete this job posting?')) {
                $.ajax({
                    url: `/api/jobs/${jobId}`,
                    type: 'DELETE',
                    success: function() {
                        loadJobs(); // Refresh the list after deleting
                    },
                    error: function(jqXHR) {
                        alert(jqXHR.responseJSON.message || 'Error deleting job.');
                    }
                });
            }
        }
        
        // Load the jobs as soon as the page is ready
        $(document).ready(loadJobs);
    </script>
</body>
</html>