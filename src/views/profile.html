<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>My Profile | LinkedOut</title>
    <link rel="stylesheet" href="../public/css/style.css">
</head>
<body>
    <header class="header">
        <div class="container navbar">
            <a href="/" class="logo"><div class="logo-icon"></div>LinkedOut</a>
            <ul class="nav-links"></ul> <!-- Dynamic -->
            <div class="nav-buttons"></div> <!-- Dynamic -->
        </div>
    </header>
    <main>
        <div class="container" style="padding-top: 100px; max-width: 800px;">
            <h2 class="page-title">My Profile</h2>
            <div class="glass-card">
                <form id="profile-form">
                    <div id="form-message" style="margin-bottom: 1.5rem; text-align: center; font-weight: 500;"></div>
                    <div class="form-group">
                        <label for="name">Full Name</label>
                        <input type="text" id="name" name="name" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="email">Email Address</label>
                        <input type="email" id="email" name="email" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="skills">My Skills (Comma separated)</label>
                        <textarea id="skills" name="skills" class="form-control" rows="4"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="resume">Upload Resume (PDF only)</label>
                        <input type="file" id="resume" name="resume" class="form-control" accept=".pdf">
                        <p id="current-resume" style="margin-top: 0.5rem; font-size: 0.9rem;"></p>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;">Update Profile</button>
                </form>
            </div>
        </div>
    </main>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="../public/js/main.js"></script>
    <script>
    $(document).ready(function() {
        $.get('/api/users/me', function(data) {
            $('#name').val(data.user.name);
            $('#email').val(data.user.email);
            $('#skills').val(data.user.skills.join(', '));
            if (data.user.resumeUrl) {
                $('#current-resume').html(`Current Resume: <a href="/${data.user.resumeUrl.replace(/\\/g, '/')}" target="_blank">View</a>`);
            } else {
                 $('#current-resume').text('No resume uploaded.');
            }
        }).fail(function() {
            window.location.href = '/login';
        });

        $('#profile-form').on('submit', function(event) {
            event.preventDefault();
            const formData = new FormData(this);
            const $formMessage = $('#form-message');

            $.ajax({
                url: '/api/users/profile',
                type: 'POST',
                data: formData,
                processData: false,
                contentType: false,
                success: function(response) {
                    $formMessage.css('color', 'var(--success-color)').text(response.message);
                },
                error: function(jqXHR) {
                    $formMessage.css('color', 'var(--error-color)').text(jqXHR.responseJSON.message || 'Update failed.');
                }
            });
        });
    });
    </script>
</body>
</html>