<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Post a New Job | LinkedOut</title>
    <!-- Shared Styles -->
    <link rel="stylesheet" href="../public/css/style.css">
</head>
<body>
    <header class="header">
        <div class="container navbar">
            <a href="/" class="logo"><div class="logo-icon"></div>LinkedOut</a>
            <ul class="nav-links">
                <li><a href="/post-job" class="active">Post a Job</a></li>
                <li><a href="/profile">Company Profile</a></li>
            </ul>
            <div class="nav-buttons">
                <a href="/" class="btn btn-login">Logout</a>
            </div>
        </div>
    </header>

    <main>
        <div class="container" style="padding-top: 100px; max-width: 800px;">
            <h2 class="page-title">Create a New Job Listing</h2>
            <div class="glass-card">
                <form id="post-job-form" novalidate>
                    <div id="form-message" style="margin-bottom: 1.5rem; text-align: center; font-weight: 500;"></div>

                    <div class="form-group">
                        <label for="title">Job Title</label>
                        <input type="text" id="title" class="form-control" placeholder="e.g., Software Engineer Intern" required>
                    </div>

                    <div class="form-group">
                        <label for="company">Company Name</label>
                        <input type="text" id="company" class="form-control" placeholder="e.g., Acme Corporation" required>
                    </div>

                    <div class="form-group">
                        <label for="location">Location</label>
                        <input type="text" id="location" class="form-control" placeholder="e.g., San Francisco, CA or Remote" required>
                    </div>

                    <div class="form-group">
                        <label for="jobType">Job Type</label>
                        <select id="jobType" class="form-control" required>
                            <option value="internship">Internship</option>
                            <option value="full-time">Full-Time</option>
                            <option value="part-time">Part-Time</option>
                            <option value="volunteer">Volunteer</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="description">Job Description</label>
                        <textarea id="description" class="form-control" rows="6" placeholder="Describe the role and responsibilities..." required></textarea>
                    </div>

                    <div class="form-group">
                        <label for="skillsRequired">Required Skills (Comma separated)</label>
                        <textarea id="skillsRequired" class="form-control" rows="3" placeholder="e.g., JavaScript, React, Node.js" required></textarea>
                    </div>

                    <div class="form-group">
                        <label for="salaryDetails">Salary / Stipend Details</label>
                        <input type="text" id="salaryDetails" class="form-control" placeholder="e.g., $7,500/month stipend or Unpaid">
                    </div>

                    <button type="submit" class="btn btn-primary" style="width: 100%; padding: 0.8rem;">Post Job</button>
                </form>
            </div>
        </div>
    </main>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script>
        $(document).ready(function() {
            $('#post-job-form').on('submit', function(event) {
                event.preventDefault();
                const $formMessage = $('#form-message');
                const $submitButton = $(this).find('button[type="submit"]');

                const jobData = {
                    title: $('#title').val(),
                    company: $('#company').val(),
                    location: $('#location').val(),
                    jobType: $('#jobType').val(),
                    description: $('#description').val(),
                    skillsRequired: $('#skillsRequired').val(),
                    salary: {
                        details: $('#salaryDetails').val()
                    }
                };

                $.ajax({
                    url: '/api/jobs/post',
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify(jobData),
                    beforeSend: function() {
                        $submitButton.prop('disabled', true).text('Submitting...');
                        $formMessage.empty().css('color', 'var(--text-muted-color)').text('Submitting job post...');
                    },
                    success: function(response) {
                        $formMessage.css('color', 'var(--success-color)').text(response.message);
                        $('#post-job-form')[0].reset(); // Reset the form on success
                    },
                    error: function(jqXHR) {
                        let errorMessage = 'An error occurred.';
                        if (jqXHR.responseJSON && jqXHR.responseJSON.message) {
                            errorMessage = jqXHR.responseJSON.message;
                        }
                        $formMessage.css('color', 'var(--error-color)').text(errorMessage);
                    },
                    complete: function() {
                        setTimeout(() => {
                            $submitButton.prop('disabled', false).text('Post Job');
                        }, 2000);
                    }
                });
            });
        });
    </script>
</body>
</html>